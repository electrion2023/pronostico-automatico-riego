name: üå¶Ô∏è Actualizar Pron√≥stico

on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  update-weather:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Obtener c√≥digo
      uses: actions/checkout@v4
      
    - name: ‚éî Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: üì¶ Instalar dependencias
      run: |
        npm init -y --silent
        npm install firebase-admin axios --save
      
    - name: üêõ Ejecutar con debug completo
      env:
        FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
        FIREBASE_PRIVATE_KEY_ID: ${{ secrets.FIREBASE_PRIVATE_KEY_ID }}
        FIREBASE_PRIVATE_KEY: "${{ secrets.FIREBASE_PRIVATE_KEY }}"
        FIREBASE_CLIENT_EMAIL: ${{ secrets.FIREBASE_CLIENT_EMAIL }}
        FIREBASE_CLIENT_ID: ${{ secrets.FIREBASE_CLIENT_ID }}
        NODE_DEBUG: firebase-admin
      run: |
        echo "=== INICIANDO EJECUCI√ìN ==="
        node -e "
        try {
          console.log('üîß Cargando script...');
          require('./scripts/actualizar-pronostico.js');
          console.log('‚úÖ Script cargado correctamente');
        } catch (error) {
          console.error('‚ùå Error cargando script:', error);
          process.exit(1);
        }
        " || exit 1
        
        echo "=== EJECUTANDO SCRIPT COMPLETO ==="
        node scripts/actualizar-pronostico.js
