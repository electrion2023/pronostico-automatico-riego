name: üå¶Ô∏è Actualizar Pron√≥stico Autom√°tico

on:
  schedule:
    # Ejecutar cada 30 minutos
    - cron: '*/2 * * * *'
  # Permite ejecuci√≥n manual desde GitHub
  workflow_dispatch:
    inputs:
      reason:
        description: 'Raz√≥n de ejecuci√≥n manual'
        required: false
        default: 'Ejecuci√≥n manual'

jobs:
  update-weather:
    name: üìä Actualizar pron√≥stico de lluvia
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Obtener c√≥digo
      uses: actions/checkout@v4
      
    - name: ‚éî Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: üì¶ Instalar dependencias
      run: |
        echo "üîß Instalando dependencias..."
        npm install --no-package-lock --no-save firebase-admin axios
        echo "‚úÖ Dependencias instaladas"
      
    - name: üå¶Ô∏è Ejecutar actualizaci√≥n de pron√≥stico
      env:
        FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
        FIREBASE_PRIVATE_KEY_ID: ${{ secrets.FIREBASE_PRIVATE_KEY_ID }}
        FIREBASE_PRIVATE_KEY: "${{ secrets.FIREBASE_PRIVATE_KEY }}"
        FIREBASE_CLIENT_EMAIL: ${{ secrets.FIREBASE_CLIENT_EMAIL }}
        FIREBASE_CLIENT_ID: ${{ secrets.FIREBASE_CLIENT_ID }}
      run: node scripts/actualizar-pronostico.js
      
    - name: ‚úÖ Notificar √©xito
      if: success()
      run: |
        echo "‚úÖ Pron√≥stico actualizado exitosamente - $(date)"
        
    - name: ‚ùå Notificar fallo
      if: failure()
      run: |
        echo "‚ùå Fall√≥ la actualizaci√≥n del pron√≥stico - $(date)"
