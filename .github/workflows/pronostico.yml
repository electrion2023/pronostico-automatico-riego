name: ğŸŒ¦ï¸ PronÃ³stico Robusto

on:
  schedule:
    - cron: '*/10 * * * *'  # Cada 10 minutos (mÃ¡s confiable)
  workflow_dispatch:

jobs:
  update-weather:
    name: ğŸ“Š Actualizar pronÃ³stico
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ğŸ“¥ Obtener cÃ³digo
      uses: actions/checkout@v4
      
    - name: â” Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Instalar dependencias
      run: |
        npm init -y --silent
        npm install firebase-admin axios --save --silent
        echo "âœ… Dependencias instaladas"
      
    - name: ğŸ”„ Reintentar en caso de error
      continue-on-error: true
      env:
        FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
        FIREBASE_PRIVATE_KEY_ID: ${{ secrets.FIREBASE_PRIVATE_KEY_ID }}
        FIREBASE_PRIVATE_KEY: "${{ secrets.FIREBASE_PRIVATE_KEY }}"
        FIREBASE_CLIENT_EMAIL: ${{ secrets.FIREBASE_CLIENT_EMAIL }}
        FIREBASE_CLIENT_ID: ${{ secrets.FIREBASE_CLIENT_ID }}
      run: |
        echo "ğŸ•’ Iniciando ejecuciÃ³n - $(TZ='America/Argentina/Buenos_Aires' date)"
        node scripts/actualizar-pronostico.js
        echo "âœ… EjecuciÃ³n completada"
        
    - name: ğŸ“ Registrar resultado
      if: always()
      run: |
        echo "ğŸ Resultado del workflow: ${{ job.status }}"
        echo "Hora: $(TZ='America/Argentina/Buenos_Aires' date)"
